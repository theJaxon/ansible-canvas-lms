---
# vars file for canvas
gems_bin_dir: "/home/{{ username }}/.gem/ruby/{{ ruby_version }}/bin/"
canvas_tar: "{{ canvas_dir }}/canvas-lms-stable.tar.gz"
canvas_url: https://github.com/instructure/canvas-lms/archive/stable.tar.gz
#repo_dir: /etc/apt/sources.list.d
ruby_repo: ppa:brightbox/ruby-ng
ruby_dependencies:
  - ruby2.6
  - ruby2.6-dev
  - zlib1g-dev
  - libxml2-dev
  - libsqlite3-dev
  - postgresql
  - libpq-dev
  - libxmlsec1-dev
  - python
  - curl 
  - make 
  - g++
  - software-properties-common
  - apt-transport-https # Required by passenger
  - ca-certificates # Required by passenger

gems:
  - name: bundler 
    version: 2.1.4
  - name: rake
    version: 13.0.1
  - name: json 
    version: 2.3.1

repos:
  - name: nodejs
    content: | 
       deb https://deb.nodesource.com/node_10.x bionic main
       deb-src https://deb.nodesource.com/node_10.x bionic main
    dest: "{{ repo_dir }}/nodesource.list"
    key: https://deb.nodesource.com/gpgkey/nodesource.gpg.key

  - name: yarn=1.10.1-1
    content: deb https://dl.yarnpkg.com/debian/ stable main
    dest: "{{ repo_dir }}/yarn.list"
    key: https://dl.yarnpkg.com/debian/pubkey.gpg

redis_ppa: ppa:chris-lea/redis-server

passenger:
  - keyserver: hkp://keyserver.ubuntu.com:80
    key_id: 561F9B9CAC40B2F7
    repo: "deb https://oss-binaries.phusionpassenger.com/apt/passenger bionic main"
  
# Canvas default configuration
default_config_files:
  - amazon_s3
  - delayed_jobs 
  - file_store 
  - external_migration

config_files:
  - database
  - domain
  - outgoing_mail
  - security
  - dynamic_settings # https://github.com/instructure/canvas-lms/wiki/Production-Start#dynamic-settings-configuration

redis_config_files:
- cache_store
- redis 

# database.conf details 
postgres_host: localhost
postgres_username: canvas
postgres_password: canvas123 #TODO use ansible-vault instead

# canvas.conf details 
canvas_server_name: "testcanvas.com"
canvas_document_root: "/var/canvas/public"
canvas_server_admin: canvas@example.com

# https://github.com/instructure/canvas-lms/wiki/Production-Start#generate-assets
assets_dirs:
- tmp/pids
- public/assets
- app/stylesheets/brandable_css_brands

assets_files:
- app/stylesheets/_brandable_variables_defaults_autogenerated.scss
- Gemfile.lock
- log/production.log

assets_ownership:
- config/environment.rb
- log
- tmp 
- public/assets
- app/stylesheets/_brandable_variables_defaults_autogenerated.scss
- app/stylesheets/brandable_css_brands Gemfile.lock config.ru

remaining_packages:
- redis-server 
- libapache2-mod-xsendfile
---
# vars file for canvas
gems_bin_dir: "/home/{{ username }}/.gem/ruby/{{ ruby_version }}/bin/"
canvas_tar: "{{ canvas_dir }}/canvas-lms-stable.tar.gz"
canvas_url: https://github.com/instructure/canvas-lms/archive/stable.tar.gz
#repo_dir: /etc/apt/sources.list.d

keys:
  - name: nodejs 
    key: https://deb.nodesource.com/gpgkey/nodesource.gpg.key
  - name: yarn 
    key: https://dl.yarnpkg.com/debian/pubkey.gpg
  - name: passenger 
    keyserver: hkp://keyserver.ubuntu.com:80
    id: 561F9B9CAC40B2F7

repos: 
  - name: ruby 
    repo: ppa:brightbox/ruby-ng
  - name: nodejs 
    repo: deb https://deb.nodesource.com/node_10.x bionic main
  - name: yarn
    repo: deb https://dl.yarnpkg.com/debian/ stable main
  - name: redis
    repo: ppa:chris-lea/redis-server
  - name: passenger 
    repo: deb https://oss-binaries.phusionpassenger.com/apt/passenger bionic main

#ruby_repo: ppa:brightbox/ruby-ng
base_software:
  - ruby2.6
  - ruby2.6-dev
  - zlib1g-dev
  - libxml2-dev
  - libsqlite3-dev
  - postgresql
  - libpq-dev
  - libxmlsec1-dev
  - python
  - curl 
  - make 
  - g++
  - software-properties-common
  - nodejs
  - yarn=1.10.1-1
  - apt-transport-https # Required by passenger
  - ca-certificates # Required by passenger

gems:
  - name: bundler 
    version: 2.1.4
  - name: rake
    version: 13.0.1
  - name: json 
    version: 2.3.1
  
# Canvas default configuration
default_config_files:
  - amazon_s3
  - delayed_jobs 
  - file_store 
  - external_migration

config_files:
  - database
  - domain
  - outgoing_mail
  - security
  - dynamic_settings # https://github.com/instructure/canvas-lms/wiki/Production-Start#dynamic-settings-configuration

redis_config_files:
  - cache_store
  - redis 

# database.conf details 
postgres_host: localhost
postgres_username: canvas
postgres_password: canvas123 #TODO use ansible-vault instead

# canvas.conf details 
canvas_server_name: "testcanvas.com"
canvas_document_root: "/var/canvas/public"
canvas_server_admin: canvas@example.com

# https://github.com/instructure/canvas-lms/wiki/Production-Start#generate-assets
assets_dirs:
  - tmp/pids
  - public/assets
  - app/stylesheets/brandable_css_brands

assets_files:
  - app/stylesheets/_brandable_variables_defaults_autogenerated.scss
  - Gemfile.lock
  - log/production.log

assets_ownership:
  - config/environment.rb
  - log
  - tmp 
  - public/assets
  - app/stylesheets/_brandable_variables_defaults_autogenerated.scss
  - app/stylesheets/brandable_css_brands Gemfile.lock config.ru

web_packages:
  - passenger 
  - apache2
  - libapache2-mod-passenger

apache2_modules:
  - passenger 
  - rewrite
  - ssl 

remaining_packages:
  - redis-server 
  - libapache2-mod-xsendfile